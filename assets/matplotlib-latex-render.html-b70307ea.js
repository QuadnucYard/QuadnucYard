import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as t,c as p,b as s,d as n,f as a}from"./app-83413d23.js";const o="data:image/png;base64,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",l="data:image/png;base64,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",i="/assets/demo-faac3114.png",c={},u=a(`<h1 id="使用-matplotlib-渲染-latex-公式" tabindex="-1"><a class="header-anchor" href="#使用-matplotlib-渲染-latex-公式" aria-hidden="true">#</a> 使用 Matplotlib 渲染 Latex 公式</h1><p>需求：将 Latex 公式转为图片，svg 或 png 格式。</p><p>其实我们熟悉的 matplotlib 就支持这个功能，可以应付一些简单的情况（复杂的后面说）。</p><h2 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法" aria-hidden="true">#</a> 基本用法</h2><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>font_manager <span class="token keyword">as</span> mfm
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>mathtext <span class="token keyword">import</span> math_to_image

prop <span class="token operator">=</span> mfm<span class="token punctuation">.</span>FontProperties<span class="token punctuation">(</span>math_fontfamily<span class="token operator">=</span><span class="token string">&#39;stix&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">&#39;bold&#39;</span><span class="token punctuation">)</span>
math_to_image<span class="token punctuation">(</span><span class="token string">r&quot;$\\sum_{i=1}^n i$&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;path/to/output.svg&quot;</span><span class="token punctuation">,</span> prop<span class="token operator">=</span>prop<span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>两行代码结束。下面解释一些内容。</p><ul><li><code>math_fontfamily</code>：数学字体。有多个选项（见 api），这个字体是我认为比较合适的、接近一般印刷体的。</li><li><code>size</code>：字体大小。</li><li><code>weight</code>：粗细。其实对数学字体不起作用。</li><li><code>dpi</code>：输出图像的 DPI。</li><li>公式可以不全是 latex 公式，只有 <code>$$</code> 内的才会解释为 latex。</li><li>输出可以是路径或 buffer。如果路径自带后缀名，可以不用指定 format。</li></ul><h2 id="图片边界问题" tabindex="-1"><a class="header-anchor" href="#图片边界问题" aria-hidden="true">#</a> 图片边界问题</h2>`,8),r={class:"katex"},d=s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mfrac",null,[s("mrow",null,[s("mi",{mathvariant:"normal"},"∂"),s("mi",null,"ρ")]),s("mrow",null,[s("mi",{mathvariant:"normal"},"∂"),s("mi",null,"t")])]),s("mo",null,"="),s("mo",null,"−"),s("mi",{mathvariant:"normal"},"∇"),s("mo",null,"⋅"),s("mover",{accent:"true"},[s("mi",null,"j"),s("mo",null,"⃗")])]),s("annotation",{encoding:"application/x-tex"},"\\frac{\\partial\\rho}{\\partial t}=-\\nabla\\cdot\\vec{j}")])])],-1),m={class:"katex-html","aria-hidden":"true"},k=a('<span class="base"><span class="strut" style="height:1.2772em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">ρ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">∇</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span>',2),h={class:"base"},g=s("span",{class:"strut",style:{height:"1.137em","vertical-align":"-0.1944em"}},null,-1),v={class:"mord accent"},b={class:"vlist-t vlist-t2"},f={class:"vlist-r"},A={class:"vlist",style:{height:"0.9425em"}},y=s("span",{style:{top:"-3em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05724em"}},"j")],-1),w={style:{top:"-3.2285em"}},x=s("span",{class:"pstrut",style:{height:"3em"}},null,-1),q={class:"accent-body",style:{left:"-0.2355em"}},M={class:"overlay",style:{height:"0.714em",width:"0.471em"}},Y={xmlns:"http://www.w3.org/2000/svg",width:"0.471em",height:"0.714em",style:{width:"0.471em"},viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},D=s("path",{d:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`},null,-1),z=[D],O=s("span",{class:"vlist-s"},"​",-1),Z=s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1944em"}},[s("span")])],-1),V=a('<figure><img src="'+o+`" alt="" tabindex="0" loading="lazy"><figcaption><code>$\\frac{\\partial\\rho}{\\partial t}=-\\nabla\\cdot\\vec{j}$</code></figcaption></figure><p>边界计算出了点问题，导致图片外围有部分被截断了。</p><p>如何解决这个问题呢？注意到，<code>math_to_image</code> 没有任何参数来控制 margin。但是我们可以重写一个！来看看它原来是怎样的：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">math_to_image</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> filename_or_obj<span class="token punctuation">,</span> prop<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                  <span class="token operator">*</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Given a math expression, renders it in a closely-clipped bounding
    box to an image file.

    Parameters
    ----------
    s : str
        A math expression.  The math portion must be enclosed in dollar signs.
    filename_or_obj : str or path-like or file-like
        Where to write the image data.
    prop : \`.FontProperties\`, optional
        The size and style of the text.
    dpi : float, optional
        The output dpi.  If not set, the dpi is determined as for
        \`.Figure.savefig\`.
    format : str, optional
        The output format, e.g., &#39;svg&#39;, &#39;pdf&#39;, &#39;ps&#39; or &#39;png&#39;.  If not set, the
        format is determined as for \`.Figure.savefig\`.
    color : str, optional
        Foreground color, defaults to :rc:\`text.color\`.
    &quot;&quot;&quot;</span>
    <span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> figure

    parser <span class="token operator">=</span> MathTextParser<span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
    width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _ <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>s<span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">,</span> prop<span class="token operator">=</span>prop<span class="token punctuation">)</span>

    fig <span class="token operator">=</span> figure<span class="token punctuation">.</span>Figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">72.0</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">72.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> depth<span class="token operator">/</span>height<span class="token punctuation">,</span> s<span class="token punctuation">,</span> fontproperties<span class="token operator">=</span>prop<span class="token punctuation">,</span> color<span class="token operator">=</span>color<span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>filename_or_obj<span class="token punctuation">,</span> dpi<span class="token operator">=</span>dpi<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token builtin">format</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> depth
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它做的就是利用 parser 计算出公式的尺寸，然后画到 figure 上，再把 figure 保存。那么这里就有操作空间了，增加一下<code>figsize</code>。将这个函数复制一份，修改如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>	fig <span class="token operator">=</span> figure<span class="token punctuation">.</span>Figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>width<span class="token operator">+</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">72.0</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">72.0</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> depth<span class="token operator">/</span>height<span class="token punctuation">,</span> s<span class="token punctuation">,</span> fontproperties<span class="token operator">=</span>prop<span class="token punctuation">,</span> color<span class="token operator">=</span>color<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这样成功实现了增加 margin。</p><figure><img src="`+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',8),C=s("p",null,[n("这里 margin 可以自适应调整一下。需要注意，"),s("code",null,"fig.text"),n(" 的坐标范围是归一化的 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mo",{stretchy:"false"},"["),s("mn",null,"0"),s("mo",{separator:"true"},","),s("mn",null,"1"),s("mo",{stretchy:"false"},"]")]),s("annotation",{encoding:"application/x-tex"},"[0,1]")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"["),s("span",{class:"mord"},"0"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},"1"),s("span",{class:"mclose"},"]")])])]),n("。")],-1),R=a(`<h2 id="对输出图片做处理" tabindex="-1"><a class="header-anchor" href="#对输出图片做处理" aria-hidden="true">#</a> 对输出图片做处理</h2><p>下面实现了一个功能：将图片反色（默认是黑色字白色背景），并且去除背景色。<br> 因为本来就是黑白的，所以只需要提取 rgb 之一的通道，将其取反后作为新的各通道值。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">get_img</span><span class="token punctuation">(</span>tex<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bfo <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    math_to_image<span class="token punctuation">(</span>tex<span class="token punctuation">,</span> bfo<span class="token punctuation">,</span> prop<span class="token operator">=</span>prop<span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">)</span>
    im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>bfo<span class="token punctuation">)</span>
    r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a <span class="token operator">=</span> im<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
    im <span class="token operator">=</span> Image<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token string">&quot;RGBA&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> im
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="公式语法支持" tabindex="-1"><a class="header-anchor" href="#公式语法支持" aria-hidden="true">#</a> 公式语法支持</h2><p>Matplotlib 的 latex 语法是比较弱的，它只支持一个较小但常用的子集。暂时没看到完整版的支持列表。</p><p>目前已知不支持的有：</p><ul><li><code>\\LaTeX</code></li><li><code>\\color</code></li><li><code>\\mathrm</code></li><li><code>\\begin</code></li><li><code>\\varPhi</code></li><li><code>\\frac{}{}</code> 缺括号</li></ul><h2 id="与公式识别结合" tabindex="-1"><a class="header-anchor" href="#与公式识别结合" aria-hidden="true">#</a> 与公式识别结合</h2><p>这里我们尝试识别图片公式再渲染。一个免费的识别网站为 <code>https://simpletex.cn/ai/latex_ocr</code></p><p>它的效果比 Mathpix 稍差，比如可能错误识别字体，<code>\\varphi</code> 识别成 <code>\\phi</code>，<code>\\hat</code> 识别成 <code>\\widehat</code>。</p><p>下面做一个简单的处理：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">sub_d</span><span class="token punctuation">(</span>m<span class="token punctuation">:</span> re<span class="token punctuation">.</span>Match<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>string<span class="token punctuation">[</span>m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">:</span>m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">r&quot;\\mathrm{&quot;</span>
            <span class="token keyword">or</span> m<span class="token punctuation">.</span>string<span class="token punctuation">[</span>m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token string">r&quot;\\!\\mathrm{d}&quot;</span>

<span class="token keyword">def</span> <span class="token function">fix_tex</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&quot;(\\\\frac)\\s*(\\\\[a-zA-Z]+|\\w)&quot;</span><span class="token punctuation">,</span> <span class="token string">r&quot;\\1{\\2}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token comment"># 简单地加括号</span>
    s <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&quot;\\\\color\\{.+?\\}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token comment"># 去掉 \\color</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">r&quot;\\text&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 去掉 \\text</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;e^&quot;</span><span class="token punctuation">,</span> <span class="token string">r&quot;\\mathrm{e}^&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 把 e 转为正体</span>
    s <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&quot;(?&lt;!([a-z]))d&quot;</span><span class="token punctuation">,</span> sub_d<span class="token punctuation">,</span> s<span class="token punctuation">)</span>  <span class="token comment"># 微分符号</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">r&quot;\\widehat&quot;</span><span class="token punctuation">,</span> <span class="token string">r&quot;\\hat&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>涉及到 <code>\\frac</code> 括号匹配的稍微复杂点，需要做词法分析。如果工作量不大还是手动修复吧。</p><h2 id="把公式绘制画布上" tabindex="-1"><a class="header-anchor" href="#把公式绘制画布上" aria-hidden="true">#</a> 把公式绘制画布上</h2>`,14),j=s("p",null,[n("下面是一个示例。将公式 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mo",{stretchy:"false"},"("),s("mi",null,"ψ"),s("mo",{separator:"true"},","),s("mi",null,"φ"),s("msup",null,[s("mo",{stretchy:"false"},")"),s("mo",null,"∗")]),s("mo",null,"="),s("mo",{stretchy:"false"},"("),s("mi",null,"φ"),s("mo",{separator:"true"},","),s("mi",null,"ψ"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"(\\psi,\\varphi)^*=(\\varphi,\\psi)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"ψ"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal"},"φ"),s("span",{class:"mclose"},[s("span",{class:"mclose"},")"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.6887em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mbin mtight"},"∗")])])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"φ"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"ψ"),s("span",{class:"mclose"},")")])])]),n(" 画到 Figure 上，两个均位于中心，一个旋转了 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mn",null,"30"),s("mi",{mathvariant:"normal"},"°")]),s("annotation",{encoding:"application/x-tex"},"30\\degree")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6944em"}}),s("span",{class:"mord"},"30°")])])]),n("，一个改变了字体大小。利用 Image 在 jupyter 显示。")],-1),B=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> figure
    <span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>text <span class="token keyword">import</span> Text

    s <span class="token operator">=</span> <span class="token string">r&quot;$(\\psi,\\varphi)^*=(\\varphi,\\psi)$&quot;</span>
    fig <span class="token operator">=</span> figure<span class="token punctuation">.</span>Figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1920</span> <span class="token operator">/</span> <span class="token number">72.0</span><span class="token punctuation">,</span> <span class="token number">1080</span> <span class="token operator">/</span> <span class="token number">72.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    args <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;fontproperties&quot;</span><span class="token punctuation">:</span> prop<span class="token punctuation">,</span>
        <span class="token string">&quot;horizontalalignment&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;verticalalignment&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;animated&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
    <span class="token punctuation">}</span>
    fig<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token operator">**</span>args<span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">32</span> <span class="token punctuation">,</span><span class="token operator">**</span>args<span class="token punctuation">)</span>
    bfo <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>bfo<span class="token punctuation">)</span>
    im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>bfo<span class="token punctuation">)</span>
    <span class="token keyword">return</span> im

test<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+i+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',2);function G(P,T){return t(),p("div",null,[u,s("p",null,[n("直接这样做会有一个问题。比如 "),s("span",r,[d,s("span",m,[k,s("span",h,[g,s("span",v,[s("span",b,[s("span",f,[s("span",A,[y,s("span",w,[x,s("span",q,[s("span",M,[(t(),p("svg",Y,z))])])])]),O]),Z])])])])]),n("，它渲染出来是这样的：")]),V,C,R,j,B])}const W=e(c,[["render",G],["__file","matplotlib-latex-render.html.vue"]]);export{W as default};
